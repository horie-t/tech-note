---
title: "Unleash + Spring Bootã§ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã‚’å®Ÿè£…ã™ã‚‹"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["unleash", "featureflag", "springboot"]
published: true
---

## ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã¨ã¯

ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã¯ã€ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚°ãƒ«ã€ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ã‚¹ã‚¤ãƒƒãƒç­‰ã¨ã‚‚å‘¼ã°ã‚Œã¾ã™ã€‚ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã¯ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã›ãšã«ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œã‚’å¤‰æ›´ã™ã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã®ç·ç§°ã§ã™ã€‚ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã‚’ä½¿ã†ã“ã¨ã«ã‚ˆã£ã¦ã€

1. é–‹ç™ºé€”ä¸Šã®ã‚³ãƒ¼ãƒ‰ã‚’mainãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã—ã¦ã‚‚ç„¡åŠ¹åŒ–ã—ã¦å‹•ä½œã—ãªã„ã‚ˆã†ã«ã™ã‚‹äº‹ãŒã§ãã€é »ç¹ã«mainãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã—ã¦é–‹ç™ºãƒ–ãƒ©ãƒ³ãƒãŒé•·æœŸé–“å­˜åœ¨ã—ãªã„ã‚ˆã†ã«ã—ã¦ã€ãƒãƒ¼ã‚¸æ™‚ã®ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’æ¸›ã‚‰ã™äº‹ãŒã§ãã€ã¾ãŸ
2. ãƒ•ãƒ©ã‚°ã«ã‚ˆã£ã¦A/Bãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹äº‹ã‚‚ã§ãã€
3. æ–°ã—ã„æ©Ÿèƒ½ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å°å…¥ã—ãŸäº‹ã«ã‚ˆã‚‹æ‚ªå½±éŸ¿ãŒã‚ã£ãŸå ´åˆã«ã€åˆ‡ã‚Šæˆ»ã—ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã›ãšã«æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹äº‹ã«ã‚ˆã£ã¦å…ƒã«æˆ»ã™äº‹ãŒã§ãã€
4. ç¤¾å†…ãƒ¦ãƒ¼ã‚¶ã‚„ãƒ™ãƒ¼ã‚¿ãƒ¦ãƒ¼ã‚¶ã«ã®ã¿æ–°æ©Ÿèƒ½ã‚’å…¬é–‹ã™ã‚‹äº‹ãŒã§ã

ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

[Unleash](https://www.getunleash.io/)ã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ç®¡ç†ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚æœ¬è¨˜äº‹ã§ã¯Unleashã®ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã—ã¦ã€Spring Bootã‹ã‚‰ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã®å€¤ã‚’å–å¾—ã™ã‚‹å®Ÿè£…æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚

## Unleashã‚’ãƒ­ãƒ¼ã‚«ãƒ«PCã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Unleashã®ã‚µãƒ¼ãƒã‚’ãƒ­ãƒ¼ã‚«ãƒ«PCã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚(æœ¬è¨˜äº‹ã§ã®æ–¹æ³•ã¯ãƒ­ãƒ¼ã‚«ãƒ«PCä¸Šã§ã®å‹•ä½œç¢ºèªã®ãŸã‚ã®æ–¹æ³•ã§ã‚ã‚Šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ãªã©ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ä½¿ç”¨ã™ã‚‹å ´åˆã¯åˆ¥ã®æ–¹æ³•ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚)

#### Unleashã‚µãƒ¼ãƒã®èµ·å‹•

Unleashã®ã‚µãƒ¼ãƒã¯Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€Dockerã‚’ä½¿ã£ã¦ãƒ­ãƒ¼ã‚«ãƒ«PCä¸Šã§èµ·å‹•ã•ã›ã¾ã™ã€‚é©åˆ‡ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«Unleashã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¾ã™ã€‚

```bash
wget https://raw.githubusercontent.com/Unleash/unleash/refs/heads/main/docker-compose.yml
docker compose up -d
```

#### ç®¡ç†ç”»é¢ã¸ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:4242` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ä»¥ä¸‹ã®èªè¨¼æƒ…å ±ã‚’å…¥åŠ›ã—ã¦`Sign in`ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

User name: `admin`
Password: `unleash4all`

![](/images/unleash-mng-sigin.png)

#### ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã®ä½œæˆ

å·¦ä¸Šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ `Projects` ã‚’é¸æŠã—ã¾ã™ã€‚
![](/images/unleash-menu-projects.png)

`Default` ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—ã¾ã™ã€‚
![](/images/unleash-projects-default.png)

`Create flag` ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
![](/images/unleash-default-project-create-flag.png)

`Feature flag name`ã€`Description`ã«ãƒ•ãƒ©ã‚°ã®åå‰ã¨èª¬æ˜ã‚’å…¥åŠ›ã— `Create feature flag` ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã§ç· ã‚åˆ‡ã‚Šæ—¥æ™‚ã®ç®¡ç†æ©Ÿèƒ½ã®è¿½åŠ ã‚’ä¾‹ã«è§£èª¬ã™ã‚‹ã®ã§åå‰ã‚’ `support-due-date-time` ã¨ã—ã¾ã—ãŸã€‚
![](/images/unleash-create-flag-name.png)

#### ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œ

`Connect SDK` ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
![](/images/unleash-default-project-connect-sdk.png)

`Server side SDKs`ã®`Java`ã‚’é¸æŠã—ã¾ã™ã€‚
![](/images/unleash-connect-sdk-select-sdk.png)

`Enviroment` ã‚’é¸æŠã—ã¦ã€`Next`ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ä»Šå›ã¯ãƒ­ãƒ¼ã‚«ãƒ«PCã§å‹•ã‹ã™ã ã‘ãªã®ã§`development`ã‚’é¸æŠã—ã¦ã„ã¾ã™ã€‚
![](/images/unleash-connect-sdk-environment.png)

æ¥ç¶šã®ãŸã‚ã®è¨­å®šãŒè¡¨ç¤ºã•ã‚Œã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®æ¥ç¶šå¾…ã¡çŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚
![](/images/unleash-connect-sdk-wait-connect.png)

## Spring Bootã‹ã‚‰ã®æ¥ç¶šãƒ†ã‚¹ãƒˆ

Unleashã‚µãƒ¼ãƒã§ã®æº–å‚™ãŒã§ããŸã®ã§ã€ã‚µãƒ¼ãƒã«æ¥ç¶šã§ãã‚‹ã‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

#### Spring Bootãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

[Spring Intializr](https://start.spring.io/)ã§ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¦ `GENERATE`ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
![](/images/unleash-spring-initializr.png)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦é©åˆ‡ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å±•é–‹ã—ã¾ã™ã€‚

pom.xmlã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆãŒçµ‚ã‚ã£ãŸã‚‰ã“ã®è¨˜è¿°ã¯å‰Šé™¤ã—ã¾ã™ã€‚
```xml:pom.xml
<dependency>
    <groupId>io.getunleash</groupId>
    <artifactId>unleash-client-java</artifactId>
    <version>LATEST</version>
</dependency>
```

Spring Bootã®Applicationã‚¯ãƒ©ã‚¹ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¦å‹•ä½œç¢ºèªã—ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆãŒçµ‚ã‚ã£ãŸã‚‰è¿½åŠ ã—ãŸå–œå¯¿ã‚‹ã¯å‰Šé™¤ã—ã¾ã™ã€‚

```java:src/main/java/com/t_horie/unleash_demo/UnleashDemoApplication.java
@SpringBootApplication
public class UnleashDemoApplication {

	public static void main(String[] args) {
		SpringApplication.run(UnleashDemoApplication.class, args);

		// UnleashClientã‚’åˆæœŸåŒ–
		UnleashConfig config = UnleashConfig.builder()
				.appName("unleash-onboarding-java")
				.instanceId("unleash-onboarding-instance")
				.unleashAPI("http://localhost:4242/api/")
				.apiKey("default:development.unleash-insecure-api-token") // in production use environment variable
				.build();

		Unleash unleash = new DefaultUnleash(config);

		while (true) {
			boolean featureEnabled = unleash.isEnabled("support-due-date-time");
			System.out.println("Feature enabled: " + featureEnabled);
            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }
	}

}
```

Spring Bootã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›´ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«Spring Bootã‚’èµ·å‹•ã—ã¦Unleashã‚µãƒ¼ãƒã«æ¥ç¶šã§ãã‚‹ã‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã« `Feature enabled: false`ãŒç¹°ã‚Šè¿”ã—è¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚

```bash
$ ./mvnw spring-boot:run
[INFO] Scanning for projects...
# ä¸­ç•¥
[INFO] Attaching agents: []

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/

 :: Spring Boot ::                (v3.4.0)
# ä¸­ç•¥
2024-11-30T12:59:56.615+09:00  INFO 75693 --- [unleash-demo] [           main] i.g.repository.FeatureBackupHandlerFile  : Unleash will try to load feature toggle states from temporary backup
Feature enabled: false
Feature enabled: false
Feature enabled: false
```

æ¥ç¶šãŒæˆåŠŸã™ã‚‹ã¨Unleashã®ç®¡ç†ç”»é¢ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®`Connection status`ãŒ`Connected`ã«å¤‰åŒ–ã—ã¾ã™ã€‚
![](/images/unleash-connect-sdk-connected.png)

## ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã‚’ä½¿ã£ãŸAPIã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…

ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚¢ãƒ—ãƒªã®APIã‚µãƒ¼ãƒã§ã€ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ãŒæœ‰åŠ¹ã«ãªã‚‹ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ç· ã‚åˆ‡ã‚Šæ—¥æ™‚ã®`dueDateTime`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¿½åŠ ã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚

#### ç· ã‚åˆ‡ã‚Šæ©Ÿèƒ½è¿½åŠ å‰ã®çŠ¶æ…‹ã‚’å®Ÿè£…

ç· ã‚åˆ‡ã‚ŠãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹å‰ã®Controllerã€Serviceã€Responseã¯ä»¥ä¸‹ã®é€šã‚Šã ã£ãŸã¨ã—ã¾ã™ã€‚

```java:src/main/java/com/t_horie/unleash_demo/TasksController.java
@RestController
@RequestMapping("/tasks")
public class TasksController {
    private final GetTasksUsecase getTasksUsecase;

    public TasksController(GetTasksUsecase getTasksUsecase) {
        this.getTasksUsecase = getTasksUsecase;
    }

    @GetMapping
    public TasksResponse getTasks() {
        return new TasksResponse(getTasksUsecase.getTasks());
    }
}
```

```java:src/main/java/com/t_horie/unleash_demo/TasksController.java
public interface GetTasksUsecase {
    List<Task> getTasks();
}
```

```java:src/main/java/com/t_horie/unleash_demo/GetTaskService.java
@Service
public class GetTaskService implements GetTasksUsecase {
    @Override
    public List<Task> getTasks() {
        // èª¬æ˜ã‚’ç°¡ç•¥åŒ–ã™ã‚‹ãŸã‚ãƒªãƒã‚¸ãƒˆãƒªã¯ä½œæˆã›ãšã«å›ºå®šã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™å®Ÿè£…ã«ã—ã¦ã„ã¾ã™ã€‚
        return List.of(
                new Task("1", "task1", "description1"),
                new Task("2", "task2", "description2"),
                new Task("3", "task3", "description3")
        );
    }
}
```

```java:src/main/java/com/t_horie/unleash_demo/TasksResponse.java
@Data
public class TasksResponse {
    private final List<Task> results;
}
```

```java:src/main/java/com/t_horie/unleash_demo/Task.java
@Data
public class Task {
    private final String id;
    private final String title;
    private final String description;
}
```

ä¸Šè¨˜ã‚’å®Ÿè£…ã—ã¦ã€Spring Bootã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«Spring Bootã‚’èµ·å‹•ã—ã¾ã™ã€‚

```bash
./mvnw spring-boot:run
```

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•å¾Œã«ã€åˆ¥ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã§ã‚¿ã‚¹ã‚¯å–å¾—APIã‚’å‘¼ã³å‡ºã™ã¨ä»¥ä¸‹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã¾ã™ã€‚

```json
$ curl -s http://localhost:8080/tasks | jq .
{
  "results": [
    {
      "id": "1",
      "title": "task1",
      "description": "description1"
    },
    {
      "id": "2",
      "title": "task2",
      "description": "description2"
    },
    {
      "id": "3",
      "title": "task3",
      "description": "description3"
    }
  ]
}
```

#### ç· ã‚åˆ‡ã‚Šæ©Ÿèƒ½ã‚’ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã¨å…±ã«å®Ÿè£…

##### Spring Bootãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹æˆã®å¤‰æ›´

ã¾ãšã€pom.xmlãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ†ã‚¹ãƒˆæ¥ç¶šã®è¨˜è¿°ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã™ã€‚

```xml:pom.xml
		<dependency>
			<groupId>io.getunleash</groupId>
			<artifactId>springboot-unleash-starter</artifactId>
			<version>1.1.0</version>
		</dependency>
```

æ¬¡ã«ã€Unleashã‚µãƒ¼ãƒã¸ã®æ¥ç¶šæ§‹æˆã‚’application.yamlã«è¨˜è¿°ã—ã¾ã™ã€‚

```yaml:src/main/resources/application.yaml
io:
  getunleash:
    app-name: unleash-onboarding-java
    instance-id: unleash-onboarding-instance
    environment: development
    api-url: "http://localhost:4242/api"
    api-token: "default:development.unleash-insecure-api-token"
```

##### ç· ã‚åˆ‡ã‚Šæ©Ÿèƒ½ã®å®Ÿè£…

æº–å‚™ãŒã§ããŸã‚‰ã€Controllerã€Serviceã€Responseã‚¯ãƒ©ã‚¹ã‚’å¤‰æ›´ã—ã¦ç· ã‚åˆ‡ã‚Šæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ã«Unleashã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚„ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚ `@Toggle`ã®`name`ã¯Unleashã®ç®¡ç†ç”»é¢ã§ç™»éŒ²ã—ãŸãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã®åå‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚`alterBean`ã¯å¾Œè¿°ã®ã€ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ãŒæœ‰åŠ¹ã«ãªã£ãŸæ™‚ã«ä½¿ã†Serviceã®åå‰ã§ã™ã€‚

```java:src/main/java/com/t_horie/unleash_demo/GetTasksUsecase.java
public interface GetTasksUsecase {
    @Toggle(name = "support-due-date-time", alterBean = "getTasksServiceNew")
    List<Task> getTasks(UnleashContext context);
}
```

Serviceã¯ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã®æœ‰åŠ¹/ç„¡åŠ¹ã®2ã¤ã®çŠ¶æ…‹ã«å¯¾å¿œã—ãŸã‚‚ã®ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

**ãƒ•ãƒ©ã‚°ãŒç„¡åŠ¹ã®å ´åˆç”¨**

```java:src/main/java/com/t_horie/unleash_demo/GetTaskService.java
@Service("getTaskServiceOld")
public class GetTaskService implements GetTasksUsecase {
    @Override
    public List<Task> getTasks(UnleashContext context) {
        // èª¬æ˜ã‚’ç°¡ç•¥åŒ–ã™ã‚‹ãŸã‚å›ºå®šã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¦ã„ã¾ã™ã€‚
        return List.of(
                new Task("1", "task1", "description1"),
                new Task("2", "task2", "description2"),
                new Task("3", "task3", "description3")
        );
    }
}
```

**ãƒ•ãƒ©ã‚°ãŒæœ‰åŠ¹ã®å ´åˆç”¨**

```java:src/main/java/com/t_horie/unleash_demo/GetTaskServiceDue.java
@Service("getTasksServiceNew")
public class GetTaskServiceDue implements GetTasksUsecase {
    public List<Task> getTasks(UnleashContext context) {
        // èª¬æ˜ã‚’ç°¡ç•¥åŒ–ã™ã‚‹ãŸã‚å›ºå®šã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¦ã„ã¾ã™ã€‚
        return List.of(
                new TaskDue("1", "task1", "description1", "2021-01-01T00:00:00Z"),
                new TaskDue("2", "task2", "description2", "2021-01-02T00:00:00Z"),
                new TaskDue("3", "task3", "description3", "2021-01-03T00:00:00Z")
        );
    }
}
```

ã“ã“ã§ `TaskDue` ã‚¯ãƒ©ã‚¹ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚

```java:src/main/java/com/t_horie/unleash_demo/TaskDue.java
@Data
@EqualsAndHashCode(callSuper = true)
public class TaskDue extends Task {
    private String dueDateTime;

    public TaskDue(String id, String title, String description, String dueDateTime) {
        super(id, title, description);
        this.dueDateTime = dueDateTime;
    }
}
```

Controllerã§ã¯ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«æ©Ÿèƒ½ãŒç„¡åŠ¹ã«ãªã£ã¦ã„ã‚‹å ´åˆã® `Qualifier` ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚ã¾ãŸãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å‘¼ã³å‡ºã—æ™‚ã«ã¯ã€Unleashã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¸¡ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

```java:src/main/java/com/t_horie/unleash_demo/TasksController.java
@RestController
@RequestMapping("/tasks")
public class TasksController {
    private final GetTasksUsecase getTasksUsecase;

    public TasksController(@Qualifier("getTaskServiceOld") GetTasksUsecase getTasksUsecase) {
        this.getTasksUsecase = getTasksUsecase;
    }

    @GetMapping
    public TasksResponse getTasks() {
        return new TasksResponse(getTasksUsecase.getTasks(UnleashContext.builder().build()));
    }
}
```

ã“ã®çŠ¶æ…‹ã§ã¯ã€Unleashã‚µãƒ¼ãƒå´ã§ã®ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ãªã„ã®ã§ç„¡åŠ¹ã®å ´åˆã®Serviceã‚¯ãƒ©ã‚¹ãŒå‘¼ã°ã‚Œã€ç· ã‚åˆ‡ã‚Šã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯è¿”ã£ã¦ãã¾ã›ã‚“ã€‚

##### ç· ã‚åˆ‡ã‚Šãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã®æœ‰åŠ¹åŒ–

Unleashã®ç®¡ç†ç”»é¢ã§ `support-due-date-time` ã®ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã‚’ `develop`ç’°å¢ƒã§æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚

![](/images/unleash-flag-enable.png)

æœ‰åŠ¹åŒ–ã—ã¦ã—ã°ã‚‰ãã™ã‚‹ã¨ç· ã‚åˆ‡ã‚Šã®å…¥ã£ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```json
$ curl -s http://localhost:8080/tasks | jq .
{
  "results": [
    {
      "id": "1",
      "title": "task1",
      "description": "description1",
      "dueDateTime": "2021-01-01T00:00:00Z"
    },
    {
      "id": "2",
      "title": "task2",
      "description": "description2",
      "dueDateTime": "2021-01-02T00:00:00Z"
    },
    {
      "id": "3",
      "title": "task3",
      "description": "description3",
      "dueDateTime": "2021-01-03T00:00:00Z"
    }
  ]
}
```